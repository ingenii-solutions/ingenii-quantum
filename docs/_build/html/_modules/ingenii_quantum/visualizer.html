<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ingenii_quantum.visualizer &#8212; Ingenii Quantum 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ingenii_quantum.visualizer</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.quantum_info</span><span class="w"> </span><span class="kn">import</span> <span class="n">Statevector</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">circuit_to_dag</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">circuit_drawer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.circuit.tools.pi_check</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi_check</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.quantum_info</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial_trace</span><span class="p">,</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">DensityMatrix</span><span class="p">,</span> <span class="n">purity</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">FancyArrowPatch</span><span class="p">,</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Ellipse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">proj3d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d.art3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Patch3D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.custom</span><span class="w"> </span><span class="kn">import</span> <span class="n">custom_style</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Arrow3D</span><span class="p">(</span><span class="n">Patch3D</span><span class="p">,</span> <span class="n">FancyArrowPatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 3D arrow class for visualizing quantum states on a Bloch sphere or Q-sphere.</span>

<span class="sd">    This class extends `Patch3D` and `FancyArrowPatch` to create a 3D arrow</span>
<span class="sd">    that can be used to represent vectors in quantum state visualization.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        xs (list): X-coordinates of the arrow.</span>
<span class="sd">        ys (list): Y-coordinates of the arrow.</span>
<span class="sd">        zs (list): Z-coordinates of the arrow.</span>
<span class="sd">        zdir (str): Direction of the arrow (default: &quot;z&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;mpl_toolkits.mplot3d.art3d&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the 3D arrow with the given coordinates and direction.</span>

<span class="sd">        Args:</span>
<span class="sd">            xs (list): X-coordinates of the arrow.</span>
<span class="sd">            ys (list): Y-coordinates of the arrow.</span>
<span class="sd">            zs (list): Z-coordinates of the arrow.</span>
<span class="sd">            zdir (str, optional): Direction of the arrow. Default is &quot;z&quot;.</span>
<span class="sd">            **kwargs: Additional arguments for `FancyArrowPatch`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)),</span> <span class="n">zs</span><span class="p">,</span> <span class="n">zdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path2d</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Renders the 3D arrow on the given Matplotlib renderer.</span>

<span class="sd">        Args:</span>
<span class="sd">            renderer (matplotlib.backend_bases.RendererBase): The renderer to draw the arrow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_segment3d</span><span class="p">)</span>
        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">proj3d</span><span class="o">.</span><span class="n">proj_transform</span><span class="p">(</span><span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path2d</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span><span class="n">x_s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">x_s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>

<div class="viewcode-block" id="QuantumVisualizer">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuantumVisualizer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the StateSpaceVisualizer with a quantum circuit.</span>

<span class="sd">        Args:</span>
<span class="sd">            qc (QuantumCircuit): The input quantum circuit or statevector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_math</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrows</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Stores arrow connections</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">QuantumCircuit</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">num_qubits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_statevectors</span><span class="p">()</span>

<div class="viewcode-block" id="QuantumVisualizer.bit_string_index">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.bit_string_index">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bit_string_index</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the index of a string of 0s and 1s.</span>

<span class="sd">        Args:</span>
<span class="sd">            s (string): bit string</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: index of the string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;s must be a string of 0 and 1&quot;</span><span class="p">)</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">lex_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ones</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuantumVisualizer.n_choose_k">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.n_choose_k">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_choose_k</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of combinations for n choose k.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): the total number of options .</span>
<span class="sd">            k (int): The number of elements.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: binomial coefficient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="QuantumVisualizer.lex_index">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.lex_index">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">lex_index</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return  the lex index of a combination..</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): the total number of options .</span>
<span class="sd">            k (int): The number of elements.</span>
<span class="sd">            lst (list): list</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: returns int index for lex order</span>

<span class="sd">        Raises:</span>
<span class="sd">            VisualizationError: if length of list is not equal to k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">!=</span> <span class="n">k</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VisualizationError</span><span class="p">(</span><span class="s2">&quot;list should have length k&quot;</span><span class="p">)</span>
        <span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">lst</span><span class="p">))</span>
        <span class="n">dualm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">n_choose_k</span><span class="p">(</span><span class="n">comb</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">dualm</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="QuantumVisualizer.count_control_num">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.count_control_num">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">count_control_num</span><span class="p">(</span><span class="n">gate_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count the number of consecutive &#39;c&#39; characters in a gate name.</span>

<span class="sd">        Args:</span>
<span class="sd">            gate_name (str): The name of the gate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of consecutive &#39;c&#39; characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate_name</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span></div>



<div class="viewcode-block" id="QuantumVisualizer.get_transformed_bitstrings">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.get_transformed_bitstrings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_transformed_bitstrings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitary</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the transformation of all basis states under a unitary matrix and output the transformed bitstrings.</span>

<span class="sd">        Args:</span>
<span class="sd">            unitary (np.ndarray): The unitary matrix of size (2^n, 2^n).</span>
<span class="sd">            tol (float): Tolerance for considering a value as non-zero.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary mapping input bitstrings to their transformed bitstrings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine the number of qubits</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">unitary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>

        <span class="c1"># Prepare a dictionary for the results</span>
        <span class="n">transformations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="c1"># Input basis state as a bitstring</span>
            <span class="n">input_bitstring</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">b&quot;</span><span class="p">)</span>
            <span class="c1"># Transformation of the basis state (column of the unitary matrix)</span>
            <span class="n">transformed_state</span> <span class="o">=</span> <span class="n">unitary</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="c1"># Identify the output bitstrings with significant amplitudes</span>
            <span class="n">transformed_bitstrings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">b&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transformed_state</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span>
            <span class="p">]</span>
            <span class="c1"># Store the mapping</span>
            <span class="n">transformations</span><span class="p">[</span><span class="n">input_bitstring</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_bitstrings</span>
        <span class="k">return</span> <span class="n">transformations</span></div>

    
<div class="viewcode-block" id="QuantumVisualizer.get_statevectors">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.get_statevectors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_statevectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract statevectors and gate information from the quantum circuit.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (list of statevectors, gate set)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="n">circuit_to_dag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">Statevector</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>
        <span class="n">gate_set</span> <span class="o">=</span> <span class="p">[{}]</span>

        <span class="c1"># Create new registers with desired names</span>
        <span class="n">new_qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">qubits</span><span class="p">),</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>  <span class="c1"># Renamed quantum register</span>
        <span class="n">new_cr</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">clbits</span><span class="p">),</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">clbits</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># Renamed classical register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qc_barriers</span> <span class="o">=</span>  <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">new_qr</span><span class="p">,</span> <span class="n">new_cr</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_cr</span> <span class="k">else</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">new_qr</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">layers</span><span class="p">()):</span>
            <span class="c1"># Create new registers with desired names</span>
            <span class="n">layer_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">new_qr</span><span class="p">,</span> <span class="n">new_cr</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_cr</span> <span class="k">else</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">new_qr</span><span class="p">)</span>
            
            <span class="n">nodes</span><span class="p">,</span> <span class="n">qargs_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="c1"># Iterate over all operation nodes (gates) in the layer</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;barrier&#39;</span><span class="p">,</span> <span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;initialize&#39;</span><span class="p">]:</span>
                    <span class="c1"># Map the qubits and classical bits to the new registers</span>
                    <span class="n">qargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_qr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">qargs</span><span class="p">]</span>
                    <span class="n">cargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_cr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">clbits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">cargs</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">cargs</span> <span class="k">else</span> <span class="p">[]</span>
                    <span class="c1"># Add the gate to the layer circuit and the full circuit with barriers</span>
                    <span class="n">layer_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="n">qargs</span><span class="p">,</span> <span class="n">cargs</span><span class="o">=</span><span class="n">cargs</span><span class="p">)</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">qc_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="n">qargs</span><span class="p">,</span> <span class="n">cargs</span><span class="o">=</span><span class="n">cargs</span><span class="p">)</span>
                    <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">qargs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qargs</span><span class="p">)</span>         
                <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;initialize&#39;</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Initialize operation not implemented for state space vizualization.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Build circuit for gate</span>
                <span class="n">flattened_qargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">qargs_list</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
                <span class="n">flattened_qargs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">flattened_qargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qubit</span><span class="p">:</span> <span class="n">qubit</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
                <span class="n">qubits</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">_index</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">flattened_qargs</span><span class="p">]</span>
                <span class="n">qc_u</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">flattened_qargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
                    <span class="n">qc_u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="n">qargs_list</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="c1"># Get unitary matrix</span>
                <span class="n">U</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_u</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
                <span class="c1"># Get bitstrings transformations</span>
                <span class="n">bitstring_transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transformed_bitstrings</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">gate_set</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;layer_id&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s1">&#39;num_qubits&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">),</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">],</span>
                    <span class="s1">&#39;qubits&#39;</span><span class="p">:</span> <span class="n">qubits</span><span class="p">,</span>
                    <span class="s1">&#39;bitstring_transformations&#39;</span><span class="p">:</span> <span class="n">bitstring_transformations</span>
                <span class="p">})</span>

                <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">layer_circuit</span><span class="p">)</span>
                <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qc_barriers</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> 

        <span class="k">return</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">gate_set</span></div>


<div class="viewcode-block" id="QuantumVisualizer.hex_to_rgb">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.hex_to_rgb">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hex_to_rgb</span><span class="p">(</span><span class="n">hex_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a hexadecimal color string to an RGB tuple.</span>

<span class="sd">        Args:</span>
<span class="sd">            hex_str (str): The hexadecimal color string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The RGB color as a numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">hex_str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">/</span> <span class="mi">255</span></div>


<div class="viewcode-block" id="QuantumVisualizer.color_range">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.color_range">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">color_range</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a color gradient between two colors.</span>

<span class="sd">        Args:</span>
<span class="sd">            c1 (str): The starting color in hexadecimal.</span>
<span class="sd">            c2 (str): The ending color in hexadecimal.</span>
<span class="sd">            n (int): The number of gradient steps.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of colors in hexadecimal format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c1_rgb</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="n">c2_rgb</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">))</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">c1_rgb</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">c2_rgb</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span></div>


<div class="viewcode-block" id="QuantumVisualizer.get_colors">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.get_colors">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_colors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a full cyclic color map with gradients.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): Total number of colors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of colors in hexadecimal format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="p">(</span>
             <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">color_range</span><span class="p">(</span><span class="s2">&quot;#55d397&quot;</span><span class="p">,</span> <span class="s2">&quot;#bb6bd6&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> 
            <span class="o">+</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">color_range</span><span class="p">(</span><span class="s2">&quot;#bb6bd6&quot;</span><span class="p">,</span> <span class="s2">&quot;#ffcc3e&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">color_range</span><span class="p">(</span><span class="s2">&quot;#ffcc3e&quot;</span><span class="p">,</span> <span class="s2">&quot;#c1c5c9&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">color_range</span><span class="p">(</span><span class="s2">&quot;#c1c5c9&quot;</span><span class="p">,</span> <span class="s2">&quot;#55d397&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="QuantumVisualizer.phase_to_rgb">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.phase_to_rgb">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">phase_to_rgb</span><span class="p">(</span><span class="n">complex_number</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">return_black</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map a phase of a complex number to a color.</span>

<span class="sd">        Args:</span>
<span class="sd">            complex_number (complex): The input complex number.</span>
<span class="sd">            n (int): Number of colors in the gradient.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: RGB color in hexadecimal format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">complex_number</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span> <span class="ow">and</span> <span class="n">return_black</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;black&#39;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">offset_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="o">//</span> <span class="mi">4</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">colors</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span> <span class="o">//</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">complex_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">complex_number</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">real_part</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">complex_number</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">complex_number</span><span class="o">.</span><span class="n">real</span>
        <span class="n">im_part</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">complex_number</span><span class="o">.</span><span class="n">imag</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">complex_number</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">corrected_num</span> <span class="o">=</span> <span class="n">real_part</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">im_part</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">corrected_num</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offset_colors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">n</span><span class="p">)]</span></div>




<div class="viewcode-block" id="QuantumVisualizer.draw_basis_states">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_basis_states">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_basis_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw basis states as text labels on the y-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">basis_states</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;|</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;0</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="si">}</span><span class="s1">b&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">⟩&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)]</span>
        <span class="n">font_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">22</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">basis_states</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.03</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">),</span> <span class="n">i</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_states</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuantumVisualizer.draw_probabilities">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_probabilities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statevector</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw probability circles for a given statevector.</span>

<span class="sd">        Args:</span>
<span class="sd">            statevector (np.ndarray): The statevector.</span>
<span class="sd">            position (int): The x-axis position of the circles.</span>
<span class="sd">            ax ( matplotlib.axes): axes to draw the probabilities</span>
<span class="sd">            tol (float): Tolerance for non-zero probabilities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statevector</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">statevector</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">statevector</span><span class="p">):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_to_rgb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span> <span class="c1"># Map the phase of the complex number to a color</span>
            <span class="n">base_size</span> <span class="o">=</span> <span class="mi">2500</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1800</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">base_size</span> <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;=</span> <span class="n">tol</span> <span class="k">else</span> <span class="n">base_size</span><span class="o">/</span><span class="mi">100</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Plot the statevector magnitude</span>
            <span class="c1"># If `display_math` is enabled, overlay a rectangle and text showing the value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_math</span> <span class="ow">and</span> <span class="n">radius</span><span class="o">&gt;=</span><span class="n">tol</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">base_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#73BBEF&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># Format the value string based on the real and imaginary parts</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="p">:</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="p">:</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;i&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;i&#39;</span>
                <span class="n">font_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))</span> 
                <span class="c1"># Add the text in the center of the rectangle</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">value_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></div>



<div class="viewcode-block" id="QuantumVisualizer.flip_bit">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.flip_bit">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flip_bit</span><span class="p">(</span><span class="n">bitstring</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flip the bit at position i in a binary string.</span>

<span class="sd">        Args:</span>
<span class="sd">            bitstring (str): The binary string.</span>
<span class="sd">            i (int): The position of the bit to flip (0-indexed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The binary string with the bit at position i flipped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">binary_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bitstring</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">binary_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">binary_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="k">else</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binary_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="QuantumVisualizer.draw_arrow">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_arrow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_arrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">,</span> <span class="n">old_vector</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw arrows connecting states between layers.</span>

<span class="sd">        Args:</span>
<span class="sd">            vector (np.ndarray): Current statevector (after the gate is applied).</span>
<span class="sd">            old_vector (np.ndarray): Previous statevector (before the gate is applied).</span>
<span class="sd">            position (int): The layer index (x-axis position in the visualization).</span>
<span class="sd">            tol (float): Tolerance for non-zero probabilities.</span>
<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="c1"># Generate normalized y-coordinates </span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        
        <span class="c1"># Generate binary labels for all basis states</span>
        <span class="n">basis_states</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;0</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="si">}</span><span class="s1">b&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)]</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span>  <span class="c1"># Indexes of all basis states</span>

        <span class="c1"># Identify basis states with non-zero probabilities in the old and new vectors</span>
        <span class="n">old_nonzero_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">basis_states</span><span class="p">)[</span><span class="n">idxs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">old_vector</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_nonzero_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">basis_states</span><span class="p">)[</span><span class="n">idxs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">gate_info</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">gate_set</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">bitstr</span> <span class="ow">in</span> <span class="n">old_nonzero_states</span><span class="p">:</span>
            <span class="c1"># Find the mapping frm the old vector basis state to the new one</span>
            <span class="n">reduced_bitstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">bitstr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">gate_info</span><span class="p">[</span><span class="s1">&#39;qubits&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="c1"># Reversing order to keep convention of basis states </span>
            <span class="n">reduced_bitstring_complementary</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">bitstr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">q</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gate_info</span><span class="p">[</span><span class="s1">&#39;qubits&#39;</span><span class="p">]])</span>
            <span class="n">child_bitstr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">new_bitstr_short</span> <span class="ow">in</span> <span class="n">gate_info</span><span class="p">[</span><span class="s1">&#39;bitstring_transformations&#39;</span><span class="p">][</span><span class="n">reduced_bitstring</span><span class="p">]:</span>
                <span class="n">new_bitstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">i_r</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">i_o</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gate_info</span><span class="p">[</span><span class="s1">&#39;qubits&#39;</span><span class="p">]:</span>
                        <span class="n">new_bitstr</span> <span class="o">+=</span> <span class="n">new_bitstr_short</span><span class="p">[</span><span class="n">i_r</span><span class="p">]</span>
                        <span class="n">i_r</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_bitstr</span> <span class="o">+=</span> <span class="n">reduced_bitstring_complementary</span><span class="p">[</span><span class="n">i_o</span><span class="p">]</span> 
                        <span class="n">i_o</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">new_bitstr</span> <span class="o">=</span> <span class="n">new_bitstr</span>  
                <span class="n">child_bitstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_bitstr</span><span class="p">)</span>    
            <span class="n">child_bitstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">child_bitstr</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">new_nonzero_states</span><span class="p">]</span>

            <span class="c1"># Draw arrows from parent states to the current state</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">child_bitstr</span><span class="p">:</span>                
                <span class="n">bitstr_idx</span> <span class="o">=</span> <span class="n">basis_states</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bitstr</span><span class="p">)</span>  <span class="c1"># Index of the current state</span>
                <span class="n">child_bitstr_idx</span> <span class="o">=</span> <span class="n">basis_states</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>  <span class="c1"># Index of the child state</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">bitstr_idx</span><span class="p">]</span>  <span class="c1"># Start point of the arrow</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">child_bitstr_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>  
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_to_rgb</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="n">child_bitstr_idx</span><span class="p">])</span>  <span class="c1"># Determine the arrow color based on the state&#39;s phase</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>  
                <span class="p">)</span></div>


<div class="viewcode-block" id="QuantumVisualizer.draw_state_space">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_state_space">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_state_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">plot_circuit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_phase_disks</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display_math</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the quantum circuit&#39;s evolution. Optionally include the circuit diagram.</span>

<span class="sd">        Args:</span>
<span class="sd">            plot_circuit (bool): If True, include the quantum circuit diagram in the figure.</span>
<span class="sd">            plt_phase_disks (bool): If True, include the diagram of phase disks in the figure.</span>
<span class="sd">            display_math (bool): If True, include the value of the statevectors in the figure.</span>
<span class="sd">            filename (str): File name to save the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.pyplot.figure: figure of the state space        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_math</span> <span class="o">=</span> <span class="n">display_math</span>
        <span class="n">base_size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>
        <span class="n">figure_size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.7</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mf">1.7</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="k">if</span> <span class="n">plot_phase_disks</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.7</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)),</span>
        <span class="p">)</span>  <span class="c1"># Adjust figure size dynamically</span>

        <span class="k">if</span> <span class="n">plot_circuit</span><span class="p">:</span>
            <span class="c1"># Save the Qiskit circuit with barriers as an image</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="n">circuit_image</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">circuit_drawer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qc_barriers</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">custom_style</span>
            <span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">circuit_image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">circuit_image</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">circuit_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">circuit_image</span><span class="p">)</span>

            <span class="c1"># Get the size of the circuit image in pixels</span>
            <span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span> <span class="o">=</span> <span class="n">circuit_img</span><span class="o">.</span><span class="n">size</span>

            <span class="c1"># Calculate the height of the image in inches</span>
            <span class="n">image_fig_height</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">/</span> <span class="n">dpi</span>

            <span class="c1"># Create the figure with two subplots</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_top</span><span class="p">,</span> <span class="n">ax_bottom</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figure_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figure_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">image_fig_height</span> <span class="o">*</span> <span class="mf">1.6</span> <span class="p">),</span>
                <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">image_fig_height</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span> <span class="n">figure_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]},</span>
            <span class="p">)</span>
            <span class="n">bottom_ratio</span> <span class="o">=</span> <span class="n">figure_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">figure_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">image_fig_height</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">)</span>

            <span class="c1"># Aspect ratio and extent for the top image</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">img_width</span> <span class="o">/</span> <span class="n">img_height</span>
            <span class="n">ax_top</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">circuit_img</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax_top</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="n">ax_top</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span>
                <span class="o">-</span><span class="mf">1.1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">),</span> <span class="n">aspect_ratio</span> <span class="o">+</span> <span class="mf">1.1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ax_top</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Set the bottom axis for state space visualization</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax_bottom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bottom_ratio</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># Create a single-plot figure if no circuit diagram is included</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">)</span>


        <span class="c1"># Draw the state space visualization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_basis_states</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_arrow</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Plot the phase disks</span>
        <span class="k">if</span> <span class="n">plot_phase_disks</span><span class="p">:</span>
            <span class="c1"># Set up the state space axis</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="o">-</span> <span class="mf">0.03</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="c1">#(-0.2, len(self.vectors) + 1)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">base_size</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">):</span>
                    <span class="n">pos_x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">pos_y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">qubit</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>
                    <span class="c1"># Get partial trace</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Statevector</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
                    <span class="n">partial_state</span> <span class="o">=</span> <span class="n">partial_trace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="n">qubit</span><span class="p">])</span><span class="o">.</span><span class="n">data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_draw_disk</span><span class="p">(</span><span class="n">partial_state</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.45</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">),</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> 
                                    <span class="n">pos_x</span><span class="o">=</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="o">=</span><span class="n">pos_y</span><span class="p">,</span> <span class="n">plot_text</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.05</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">),</span>
                                    <span class="n">bottom_ratio</span><span class="o">=</span><span class="n">bottom_ratio</span><span class="p">)</span>         
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span> <span class="o">-</span> <span class="mf">0.03</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">base_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_circuit</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
        <span class="k">return</span> <span class="n">fig</span></div>

    
<div class="viewcode-block" id="QuantumVisualizer.statevector_to_angles">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.statevector_to_angles">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">statevector_to_angles</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a quantum statevector into spherical coordinates (theta, phi) for Bloch sphere representation.</span>

<span class="sd">        Args:</span>
<span class="sd">            phi (ndarray): A 2-element array-like object representing a single-qubit statevector.</span>

<span class="sd">        Returns:</span>
<span class="sd">            theta (float): Polar angle (0 to pi).</span>
<span class="sd">            phi (float): Azimuthal angle (0 to 2*pi).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span>  <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Calculate theta, phi</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span></div>


<div class="viewcode-block" id="QuantumVisualizer.draw_bloch_sphere">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_bloch_sphere">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_bloch_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize a single-qubit quantum state on the Bloch sphere.</span>

<span class="sd">        Args:</span>
<span class="sd">            theta (float): Polar angle for the Bloch vector (default 0).</span>
<span class="sd">            phi (float): Azimuthal angle for the Bloch vector (default 0).</span>
<span class="sd">            ax (matplotlib.axes): A Matplotlib axes to draw on (optional).</span>
<span class="sd">            filename (str): Path to save the plot (optional).</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure: The Matplotlib figure object (if `fig` is not provided).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">Statevector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="n">num_qubits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">num_qubits</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input is not a single-qubit quantum state.&quot;</span><span class="p">)</span>

        <span class="c1"># Create Figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="c1"># Draw a sphere</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">275</span><span class="p">)</span>

        <span class="c1"># Force aspect ratio</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s2">&quot;set_box_aspect&quot;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Plot semi-transparent sphere</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LightSource</span><span class="p">(</span><span class="n">azdeg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">altdeg</span><span class="o">=</span><span class="mi">65</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#73BBEE&quot;</span><span class="p">,</span> <span class="n">facecolors</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Get rid of the panes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c1"># Get rid of the spines</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c1"># Get rid of the ticks</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">statevector_to_angles</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="c1"># Draw the state vector</span>
        <span class="n">x_arrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y_arrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">z_arrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_arrow</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_arrow</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_arrow</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x_arrow</span><span class="p">],</span> <span class="p">[</span><span class="n">y_arrow</span><span class="p">],</span> <span class="p">[</span><span class="n">z_arrow</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1"># Set the axes properties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">])</span>

        <span class="c1"># Draw the axes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        
        <span class="c1"># Label the axes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bloch Sphere (θ=</span><span class="si">{</span><span class="n">theta</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, φ=</span><span class="si">{</span><span class="n">phi</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
            <span class="k">return</span> <span class="n">fig</span></div>


    
<div class="viewcode-block" id="QuantumVisualizer.draw_qsphere">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_qsphere">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_qsphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">show_state_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_state_phases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">use_degrees</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the qsphere representation of a quantum state.</span>
<span class="sd">        Here, the size of the points is proportional to the probability</span>
<span class="sd">        of the corresponding term in the state and the color represents</span>
<span class="sd">        the phase.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize (tuple): Figure size in inches.</span>
<span class="sd">            ax (matplotlib.axes.Axes): An optional Axes object to be used for</span>
<span class="sd">                the visualization output. If none is specified a new matplotlib</span>
<span class="sd">                Figure will be created and used. Additionally, if specified there</span>
<span class="sd">                will be no returned Figure since it is redundant.</span>
<span class="sd">            show_state_labels (bool): An optional boolean indicating whether to</span>
<span class="sd">                show labels for each basis state.</span>
<span class="sd">            show_state_phases (bool): An optional boolean indicating whether to</span>
<span class="sd">                show the phase for each basis state.</span>
<span class="sd">            use_degrees (bool): An optional boolean indicating whether to use</span>
<span class="sd">                radians or degrees for the phase values in the plot.</span>
<span class="sd">            tol (float): tolerance to show basis state on the sphere</span>
<span class="sd">            filename (str): File to save the plot if desired</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure: A matplotlib figure instance if the ``ax`` kwarg is not set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get quantum statevector</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">Statevector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="n">num_qubits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">num_qubits</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input is not a multi-qubit quantum state.&quot;</span><span class="p">)</span>

        <span class="c1"># Create Figure</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">275</span><span class="p">)</span>

        <span class="c1"># Force aspect ratio</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s2">&quot;set_box_aspect&quot;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Plot semi-transparent sphere</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LightSource</span><span class="p">(</span><span class="n">azdeg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">altdeg</span><span class="o">=</span><span class="mi">65</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#73BBEE&quot;</span><span class="p">,</span> <span class="n">facecolors</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Get rid of the panes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c1"># Get rid of the spines</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c1"># Get rid of the ticks</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span>

        <span class="c1"># Set the axes properties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Q-sphere&#39;</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>

        <span class="c1"># Add center point</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;#73BBEE&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;#73BBEE&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Add weight lines</span>
        <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#73BBEE&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="c1"># indices quantum state in decimal form</span>
        <span class="n">non_zero_probs</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">non_zero_probs</span><span class="p">:</span>
            <span class="c1"># Get basis state</span>
            <span class="n">binstr</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">id</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">binstr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
            
            <span class="c1"># Get position of basis state in the sphere</span>
            <span class="n">number_of_divisions</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">n_choose_k</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
            <span class="n">weight_order</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">bit_string_index</span><span class="p">(</span><span class="n">binstr</span><span class="p">)</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_qubits</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                <span class="n">weight_order</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">number_of_divisions</span><span class="p">))</span>
            
            <span class="c1"># Remove global phase</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">weight</span> <span class="o">&gt;</span> <span class="n">num_qubits</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span> <span class="p">(</span><span class="n">weight</span> <span class="o">==</span> <span class="n">num_qubits</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">weight_order</span> <span class="o">&gt;=</span> <span class="n">number_of_divisions</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">angle</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">number_of_divisions</span><span class="p">)</span>

            <span class="c1"># Get cartesian coordinates</span>
            <span class="n">zvalue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">xvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zvalue</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">yvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zvalue</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

            <span class="c1"># Get size of ball (probability)</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1"># Get color of the ball (complex angle)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">phase_to_rgb</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>

            <span class="c1"># Plot state labels and angles</span>
            <span class="k">if</span> <span class="n">show_state_labels</span><span class="p">:</span>
                <span class="c1"># Transform to spherical coordinates for text</span>
                <span class="n">angle_theta</span><span class="p">,</span> <span class="n">rprime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zvalue</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">zvalue</span><span class="p">),</span> <span class="mf">1.35</span>
                <span class="n">xvalue_text</span> <span class="o">=</span> <span class="n">rprime</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">yvalue_text</span> <span class="o">=</span> <span class="n">rprime</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">zvalue_text</span> <span class="o">=</span> <span class="n">rprime</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_theta</span><span class="p">)</span>
                <span class="c1"># State label</span>
                <span class="n">element_text</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">vert&quot;</span> <span class="o">+</span> <span class="n">binstr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">rangle$&quot;</span>
                <span class="c1"># Add phases to label in degrees or radians</span>
                <span class="k">if</span> <span class="n">show_state_phases</span><span class="p">:</span>
                    <span class="n">element_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">use_degrees</span><span class="p">:</span>
                        <span class="n">element_text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">$</span><span class="si">%.1f</span><span class="s2">^</span><span class="se">\\</span><span class="s2">circ$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_angle</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">element_angle</span> <span class="o">=</span> <span class="n">pi_check</span><span class="p">(</span><span class="n">element_angle</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">pi&quot;</span><span class="p">)</span>
                        <span class="n">element_text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">$</span><span class="si">%s</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_angle</span><span class="p">)</span>
                <span class="c1"># Add label to figure</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">xvalue_text</span><span class="p">,</span> <span class="n">yvalue_text</span><span class="p">,</span> <span class="n">zvalue_text</span><span class="p">,</span> <span class="n">element_text</span><span class="p">,</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span> <span class="p">)</span>
            
            <span class="c1"># Add ball to figure</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xvalue</span><span class="p">],[</span><span class="n">yvalue</span><span class="p">],[</span><span class="n">zvalue</span><span class="p">],</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="p">)</span>
            
            <span class="c1"># Add arrow to figure</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">xvalue</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">yvalue</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zvalue</span><span class="p">],</span>
                        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
            <span class="k">return</span> <span class="n">fig</span></div>

        
<div class="viewcode-block" id="QuantumVisualizer.draw_color_legend">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_color_legend">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_color_legend</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">use_degrees</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the color legend for the qsphere and state space.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize (tuple): Figure size in inches.</span>
<span class="sd">            ax (matplotlib.axes.Axes): An optional Axes object to be used for</span>
<span class="sd">                the visualization output. If none is specified a new matplotlib</span>
<span class="sd">                Figure will be created and used. Additionally, if specified there</span>
<span class="sd">                will be no returned Figure since it is redundant.</span>
<span class="sd">            n (int): Number of divisions of the color legend.</span>
<span class="sd">            use_degrees (bool): An optional boolean indicating whether to use</span>
<span class="sd">            degrees or complex numbers.</span>
<span class="sd">            filename (str): File to save the plot if desired</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure: A matplotlib figure instance if the ``ax`` kwarg is not set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

        <span class="c1"># Get rid of the ticks</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># Draw pie</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">47</span><span class="p">:]</span> <span class="o">+</span> <span class="n">colors</span><span class="p">[:</span> <span class="mi">47</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.95</span>  <span class="c1"># since radius of sphere is one.</span>

        <span class="k">if</span> <span class="n">use_degrees</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;0º&quot;</span><span class="p">,</span> <span class="s2">&quot;90º&quot;</span><span class="p">,</span> <span class="s2">&quot;180º&quot;</span><span class="p">,</span> <span class="s2">&quot;270º&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$1$&quot;</span><span class="p">,</span> <span class="s2">&quot;$i$&quot;</span><span class="p">,</span> <span class="s2">&quot;$-1$&quot;</span><span class="p">,</span> <span class="s2">&quot;$-i$&quot;</span><span class="p">]</span>

        <span class="c1"># Write labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="mf">1.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="mf">1.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Color legend&#39;</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
            <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="QuantumVisualizer.height_for_probability">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.height_for_probability">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">height_for_probability</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">total_area</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the height (h) of a circular segment corresponding to a given probability.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius (float): Radius of the circle.</span>
<span class="sd">            prob (float): Desired probability (fraction of the circle&#39;s area to fill).</span>
<span class="sd">            total_area (float): Total area of the circle.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Height (h) of the segment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_area</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">total_area</span>  <span class="c1"># Target area to fill</span>
        <span class="n">h_low</span><span class="p">,</span> <span class="n">h_high</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span>   <span class="c1"># Binary search bounds</span>

        <span class="k">while</span> <span class="n">h_high</span> <span class="o">-</span> <span class="n">h_low</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>  <span class="c1"># Precision tolerance</span>
            <span class="n">h_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">h_low</span> <span class="o">+</span> <span class="n">h_high</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">area_segment</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">h_mid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&lt;</span> <span class="n">target_area</span><span class="p">:</span>
                <span class="n">h_low</span> <span class="o">=</span> <span class="n">h_mid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h_high</span> <span class="o">=</span> <span class="n">h_mid</span>
        <span class="k">return</span> <span class="n">h_low</span></div>

    
<div class="viewcode-block" id="QuantumVisualizer.area_segment">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.area_segment">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">area_segment</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the area of a circular segment.</span>

<span class="sd">        Args:</span>
<span class="sd">            r (float): The radius of the circle.</span>
<span class="sd">            h (float): The height of the segment (distance from the chord to the arc).</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The area of the circular segment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">h</span> <span class="o">-</span> <span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span></div>



    <span class="k">def</span><span class="w"> </span><span class="nf">_draw_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial_state</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos_y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">plot_text</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pos_label</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">equal_aspect_ratio</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bottom_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Draw phase disks ar a certain position.</span>

<span class="sd">        Args:</span>
<span class="sd">            partial_state (np.arrray): Density matrix of reduced state</span>
<span class="sd">            qubit (int): Qubit which corresponds to this phase disk</span>
<span class="sd">            ax (matplotlib.axes): Axis to draw phase disks</span>
<span class="sd">            radius (float): Radius of the disk</span>
<span class="sd">            pos_x (float): position on the x axis to plot the phase disks</span>
<span class="sd">            pos_y (float): position on the y axis to plot the phase disks</span>
<span class="sd">            plot_text (bool): If True, plot the qubit label</span>
<span class="sd">            equal_aspect_ratio (bool): If True, ensure equal aspect ratio</span>
<span class="sd">            bottom_ratio (float): Used to calculate the aspect ratio</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">equal_aspect_ratio</span><span class="p">:</span>
            <span class="n">x_aspect</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">y_aspect</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Adjust to axis dimensions</span>
            <span class="c1"># Get the axis limits</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="c1"># Calculate the aspect ratio of the axis scaling</span>
            <span class="n">x_aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Data-to-figure ratio (x)</span>
            <span class="n">y_aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">bottom_ratio</span><span class="p">)</span>  <span class="c1"># Data-to-figure ratio (y)</span>
           
        <span class="c1"># Get radius and color for phase disk</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">partial_state</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">phase_to_rgb</span><span class="p">(</span><span class="n">partial_state</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_black</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">total_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Calculate the height of the segment to fill</span>
        <span class="n">h_cutoff</span> <span class="o">=</span> <span class="n">QuantumVisualizer</span><span class="o">.</span><span class="n">height_for_probability</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">total_area</span><span class="p">)</span>

        <span class="c1"># Create grid for circle</span>
        <span class="n">circle_res</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">circle_res</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Find the points up to the cutoff height</span>
        <span class="n">cutoff_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">&lt;=</span> <span class="n">h_cutoff</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_cutoff</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">cutoff_idx</span><span class="p">]</span>
        <span class="n">x_cutoff</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">cutoff_idx</span><span class="p">]</span>
       
        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">x_aspect</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">y_aspect</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>

        <span class="c1"># Create the polygon for the filled segment</span>
        <span class="n">filled_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y_cutoff</span><span class="o">*</span><span class="n">y_aspect</span> <span class="o">+</span> <span class="n">pos_y</span><span class="p">,</span> <span class="n">y_cutoff</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y_aspect</span> <span class="o">+</span> <span class="n">pos_y</span><span class="p">])</span>
        <span class="n">filled_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="o">-</span><span class="n">x_cutoff</span><span class="o">*</span><span class="n">x_aspect</span> <span class="o">+</span> <span class="n">pos_x</span><span class="p">,</span> <span class="n">x_cutoff</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x_aspect</span> <span class="o">+</span> <span class="n">pos_x</span><span class="p">])</span>

        <span class="c1"># Plot the filled circle segment</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">filled_x</span><span class="p">,</span> <span class="n">filled_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1"># Draw purity circle</span>
        <span class="n">pur</span> <span class="o">=</span> <span class="n">purity</span><span class="p">(</span><span class="n">partial_state</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">pur</span> <span class="o">*</span> <span class="n">x_aspect</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="o">*</span> <span class="n">pur</span> <span class="o">*</span> <span class="n">y_aspect</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
        
        <span class="c1"># Draw the circle outline   </span>
        <span class="k">if</span> <span class="n">plot_text</span><span class="p">:</span> 
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos_label</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$q_</span><span class="se">{{</span><span class="si">{</span><span class="n">qubit</span><span class="si">}</span><span class="se">}}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_math</span><span class="p">:</span>
            <span class="c1"># Format the value string</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">prob</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
            <span class="n">font_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">15</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))</span> 
            <span class="c1"># Add the text in the center of the rectangle</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">,</span> <span class="n">value_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        

    
<div class="viewcode-block" id="QuantumVisualizer.draw_phase_disks">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_phase_disks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_phase_disks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_math</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the color legend for the qsphere and state space.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (matplotlib.axes.Axes): An optional Axes object to be used for</span>
<span class="sd">                the visualization output. If none is specified a new matplotlib</span>
<span class="sd">                Figure will be created and used. Additionally, if specified there</span>
<span class="sd">                will be no returned Figure since it is redundant.</span>
<span class="sd">            filename (str): File to save the plot if desired</span>
<span class="sd">            display_math (bool): If True, show the fullness of the disk</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure: A matplotlib figure instance if the ``ax`` kwarg is not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_math</span> <span class="o">=</span> <span class="n">display_math</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">):</span>
            <span class="c1"># Get partial trace</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">Statevector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">partial_state</span> <span class="o">=</span> <span class="n">DensityMatrix</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">partial_state</span> <span class="o">=</span> <span class="n">partial_trace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="n">qubit</span><span class="p">])</span><span class="o">.</span><span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_disk</span><span class="p">(</span><span class="n">partial_state</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos_y</span> <span class="o">=</span> <span class="mf">2.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="o">-</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">qubit</span><span class="p">,</span>
                            <span class="n">plot_text</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pos_label</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">equal_aspect_ratio</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                   
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Phase disks&#39;</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>

        <span class="c1"># Set limits and aspect ratio</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
            <span class="k">return</span> <span class="n">fig</span></div>

        
<div class="viewcode-block" id="QuantumVisualizer.draw_geometric_plots">
<a class="viewcode-back" href="../../source/ingenii_quantum.html#ingenii_quantum.visualizer.QuantumVisualizer.draw_geometric_plots">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_geometric_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">display_math</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and visualize geometric representations of a quantum state, </span>
<span class="sd">        including phase disks, the Q-sphere or Bloch sphere, and a color legend.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str, optional): If provided, saves the generated plot </span>
<span class="sd">                to the specified file. Defaults to None.</span>
<span class="sd">            display_math (bool): If True, show the fullness of the disks</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure: The created figure containing the plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define figure size dynamically based on the number of qubits</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="c1"># Create a GridSpec layout with 3 columns</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Phase disk</span>
        <span class="n">phase_disk_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_phase_disks</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">phase_disk_ax</span><span class="p">,</span> <span class="n">display_math</span> <span class="o">=</span> <span class="n">display_math</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Q-sphere</span>
            <span class="n">q_sphere_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_qsphere</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">q_sphere_ax</span><span class="p">,</span> <span class="n">show_state_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Bloch-sphere</span>
            <span class="n">bloch_sphere_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_bloch_sphere</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">bloch_sphere_ax</span><span class="p">)</span>
            
        <span class="c1"># Color legend</span>
        <span class="n">color_legend_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_legend</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">color_legend_ax</span><span class="p">)</span>


        <span class="c1"># Save or return</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
        <span class="k">return</span> <span class="n">fig</span></div>
</div>

            
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Ingenii Quantum</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/modules.html">ingenii_quantum</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Ingenii.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>